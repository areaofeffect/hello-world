var objectdetect=function(){"use strict";return{convertRgbaToGrayscale:function(r,t){var a=r.length;t||(t=new Uint32Array(a>>2));for(var e=0;e<a;e+=2)t[e>>2]=4899*r[e]+9617*r[++e]+1868*r[++e]+8192>>14;return t},rescaleImage:function(r,t,a,e,o){var n=a*t,s=~~(t/e),c=~~(a/e);o||(o=new r.constructor(s*a));for(var i=0;i<s;++i)for(var f=i,v=(l=~~(i*e))+n;l<v;l+=t)o[f]=r[l],f+=s;for(var f=0,h=0,u=c*e;h<u;h+=e)for(var l=~~h*s,v=l+s;l<v;++l)o[f]=o[l],++f;return o},mirrorImage:function(r,t,a,e){e||(e=new r.constructor(t*a));for(var o=0,n=0;n<a;++n){for(var s=t>>1;s>=0;--s){var c=r[o+s];e[o+s]=r[o+t-1-s],e[o+t-1-s]=c}o+=t}return e},computeCanny:function(r,t,a,e){var o=t*a;e||(e=new r.constructor(o));for(var n=e===r?new r.constructor(o):e,s=new r.constructor(o),c=2;c<t-2;++c)for(var i=c,f=0;f<a;++f)n[i]=.1117*r[i-2]+.2365*r[i-1]+.3036*r[i]+.2365*r[i+1]+.1117*r[i+2],i+=t;for(c=0;c<t;++c)for(var i=c+t,f=2;f<a-2;++f)s[i+=t]=.1117*n[i-t-t]+.2365*n[i-t]+.3036*n[i]+.2365*n[i+t]+.1117*n[i+t+t];for(var v=Math.abs,c=2;c<t-2;++c)for(var i=c+t,f=2;f<a-2;++f)e[i+=t]=v(-s[i-1-t]+s[i+1-t]-2*s[i-1]+2*s[i+1]-s[i-1+t]+s[i+1+t])+v(s[i-1-t]+2*s[i-t]+s[i+1-t]-s[i-1+t]-2*s[i+t]-s[i+1+t]);return e},equalizeHistogram:function(r,t,a){var e=r.length;a||(a=r),t||(t=5);for(var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<e;n+=t)++o[r[n]];for(var s=255*t/e,c=0,n=0;n<256;++n){var i=o[n];c=i+=c,o[n]=i*s}for(n=0;n<e;++n)a[n]=o[r[n]];return a},computeSat:function(r,t,a,e){var o=t+1;e||(e=new Uint32Array(t*a+o+a));for(var n=a*o;n>=0;n-=o)e[n]=0;for(var s=1;s<=t;++s){var c=0,i=s;e[s]=0;for(var f=1;f<=a;++f)c+=r[i-f],e[i+=o]=e[i-1]+c}return e},computeRsat:function(r,t,a,e){var o=t+1,n=a*o;e||(e=new Uint32Array(t*a+o+a));for(s=n;s>=0;s-=o)e[s]=0;for(var s=0;s<o;++s)e[s]=0;for(var c=0,i=0;i<a;++i){for(f=0;f<t;++f)e[c+o+1]=r[c-i]+e[c],++c;e[c+o]+=e[c],c++}for(var f=t-1;f>0;--f)for(var c=f+n,i=a;i>0;--i)e[(c-=o)+o]+=e[c]+e[c+1];return e},computeSquaredSat:function(r,t,a,e){var o=t+1;e||(e=new Uint32Array(t*a+o+a));for(var n=a*o;n>=0;n-=o)e[n]=0;for(var s=1;s<=t;++s){var c=0,i=s;e[s]=0;for(var f=1;f<=a;++f){var v=r[i-f];c+=v*v,e[i+=o]=e[i-1]+c}}return e},mirrorClassifier:function(r,t){t||(t=new r.constructor(r));for(var a=r[0],e=1,o=r.length-1;e<o;){++e;for(var n=0,s=r[++e];n<s;++n){if(r[++e])for(i=e+5*r[++e];e<i;){t[e+1]=a-r[e+1];var c=r[e+3];t[e+3]=r[e+4],t[e+4]=c,e+=5}else for(var i=e+5*r[++e];e<i;)t[e+1]=a-r[e+1]-r[e+3],e+=5;e+=3}}return t},compileClassifier:function(r,t,a,e){t+=1,e||(e=new Float32Array(r.length));var o=new Uint32Array(e.buffer);o[0]=r[0],o[1]=r[1];for(var n=1,s=1,c=r.length-1;s<c;){e[++n]=r[++s];for(var i=0,f=o[++n]=r[++s];i<f;++i){var v=e[++n]=r[++s],h=o[++n]=3*r[++s];if(v)for(u=n+h;n<u;)o[++n]=r[++s]+r[++s]*t,o[++n]=r[++s]*(t+1)+(r[++s]*(t-1)<<16),e[++n]=r[++s];else for(var u=n+h;n<u;)o[++n]=r[++s]+r[++s]*t,o[++n]=r[++s]+(r[++s]*t<<16),e[++n]=r[++s];for(var l=1/r[++s],d=0;d<h;)e[n-d]*=l,d+=3;l<0?(e[n+2]=r[++s],e[n+1]=r[++s],n+=2):(e[++n]=r[++s],e[++n]=r[++s])}}return e.subarray(0,n+1)},detect:function(r,t,a,e,o,n,s,c){o+=1,n+=1;for(var i=new Uint32Array(c.buffer),f=i[0],v=i[1],h=v*o,u=f*v,l=1/u,d=o*s,y=[],g=0;g+f<o;g+=s)for(var m=g,b=0;b+v<n;b+=s){var p=m+f,w=m+h,S=w+f;if(e){var j=(e[m]-e[p]-e[w]+e[S])*l;if(j<60||j>200){m+=d;continue}}for(var A=r[m]-r[p]-r[w]+r[S],G=(a[m]-a[p]-a[w]+a[S])*u-A*A,C=G>1?Math.sqrt(G):1,M=!0,U=1,I=c.length-1;U<I;){for(var R=c[++U],x=0,q=0,k=i[++U];q<k;++q){var F=0;if(i[++U])for(D=U+i[++U];U<D;){var T=(E=m+i[++U])+(65535&(H=i[++U])),z=E+(H>>16&65535);F+=c[++U]*(t[E]-t[T]-t[z]+t[T+z-E])}else for(var D=U+i[++U];U<D;){var E=m+i[++U],H=i[++U],T=E+(65535&H),z=E+(H>>16&65535);F+=c[++U]*(r[E]-r[T]-r[z]+r[T+z-E])}x+=c[U+(F>C?2:1)],U+=2}if(x<R){M=!1;break}}M&&y.push([g,b,f,v]),m+=d}return y},groupRectangles:function(r,t,a){var e=r.length;a||(a=.25);for(var o=0,n=new Array(e),s=0;s<e;++s)n[s]=0;for(var c=Math.abs,i=Math.min,s=0;s<e;++s){for(var f=!1,v=0;v<s;++v){var h=r[s],u=r[v],l=a*(i(h[2],u[2])+i(h[3],u[3]));if(c(h[0]-u[0])<=l&&c(h[1]-u[1])<=l&&c(h[0]+h[2]-u[0]-u[2])<=l&&c(h[1]+h[3]-u[1]-u[3])<=l){n[s]=n[v],f=!0;break}}f||(n[s]=o++)}for(var d=new Array(o),s=0;s<o;++s)d[s]=[0,0,0,0,0];for(s=0;s<e;++s){var y=r[s];(m=d[n[s]])[0]+=y[0],m[1]+=y[1],m[2]+=y[2],m[3]+=y[3],++m[4]}for(s=0;s<o;++s){var g=d[s][4];if(g>=t){var m=d[s];g=1/g,m[0]*=g,m[1]*=g,m[2]*=g,m[3]*=g}else d.splice(s,1)}for(var b=[],s=0;s<o;++s){for(var p=d[s],v=s+1;v<o;++v){var w=d[v],S=w[2]*a,j=w[3]*a;if(p[0]>=w[0]-S&&p[1]>=w[1]-j&&p[0]+p[2]<=w[0]+w[2]+S&&p[1]+p[3]<=w[1]+w[3]+j||w[0]>=p[0]-S&&w[1]>=p[1]-j&&w[0]+w[2]<=p[0]+p[2]+S&&w[1]+w[3]<=p[1]+p[3]+j)break}v===o&&b.push(p)}return b},detector:function(){function r(r,t,a,e){this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=t,this.context=this.canvas.getContext("2d"),this.tilted=e.tilted,this.scaleFactor=a,this.numScales=~~(Math.log(Math.min(r/e[0],t/e[1]))/Math.log(a)),this.scaledGray=new Uint32Array(r*t),this.compiledClassifiers=[];for(var o=1,n=0;n<this.numScales;++n){var s=~~(r/o);this.compiledClassifiers[n]=objectdetect.compileClassifier(e,s),o*=a}}return r.prototype.detect=function(r,t,a,e,o){void 0===a&&(a=1),void 0===t&&(t=1);var n=this.canvas.width,s=this.canvas.height;e?this.context.drawImage(r,e[0],e[1],e[2],e[3],0,0,n,s):this.context.drawImage(r,0,0,n,s);var c=this.context.getImageData(0,0,n,s).data;this.gray=objectdetect.convertRgbaToGrayscale(c,this.gray);for(var i=[],f=1,v=0;v<this.numScales;++v){var h=~~(n/f),u=~~(s/f);1===f?this.scaledGray.set(this.gray):this.scaledGray=objectdetect.rescaleImage(this.gray,n,s,f,this.scaledGray),o&&(this.canny=objectdetect.computeCanny(this.scaledGray,h,u,this.canny),this.cannySat=objectdetect.computeSat(this.canny,h,u,this.cannySat)),this.sat=objectdetect.computeSat(this.scaledGray,h,u,this.sat),this.ssat=objectdetect.computeSquaredSat(this.scaledGray,h,u,this.ssat),this.tilted&&(this.rsat=objectdetect.computeRsat(this.scaledGray,h,u,this.rsat));for(var l=objectdetect.detect(this.sat,this.rsat,this.ssat,this.cannySat,h,u,a,this.compiledClassifiers[v]),d=l.length-1;d>=0;--d){var y=l[d];y[0]*=f,y[1]*=f,y[2]*=f,y[3]*=f}i=i.concat(l),f*=this.scaleFactor}return(t?objectdetect.groupRectangles(i,t):i).sort(function(r,t){return t[4]-r[4]})},r}()}}();